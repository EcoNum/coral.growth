---
title: "Calcul de la croissance à partir de la masse squelettique"
bibliography: "biblio.bib"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
SciViews::R
```

# Introduction

La croissance des coraux peut être déterminée à partir de la masse squelettique (obtenu par conversion de la masse immergée [@Jokiel1978]).

Sipkema et al. [-@Sipkema2006] ont mis en évidence plusieurs modèles de croissace sur différentes espèces d'éponges. Ces modèles semblent être également valable pour les coraux dont le modèle linéaire ou encore le modèle exponentiel [@Osinga2011].

Le premier modèle est le modèle de croissance linéaire suivant l'équation :

$$X_t = X_0 + kt$$

avec $X_t$ étant la masse au temps t, $X_0$ la masse initial au temps 0, $k$ la constante de croissance linéaire et $t$ le temps. Si la masse des coraux est monitorée en gramme et le temps en jour, nous aurons une constante exprimé en $g/jour$. Le taux de croissance peut être obtenu via l'équation suivante :

$$k =  \frac{X_t - X_0}{t - t_0}$$
Il s'agit simplement de la pente de la droite.

Un second modèle est le modèle de croissance exponentielle suivant l'équation suivante : 

$$X_t = X_0 \times e^{bt}$$

avec $X_t$ étant la masse au temps t, $X_0$ la masse initial au temps 0, $b$ la constante de croissance exponentielle et $t$ le temps. Le taux de croissance $b$ peut être obtenu via l'aquation suivante :

$$ln(X_t) = ln(X_0 \times e^{bt})\\ ln(X_t) = ln(X_0) + bt \\ ln(X_t) - ln(X_0) = bt\\ \frac{ln(X_t) - ln(X_0)}{t}= b \\ \frac{ ln( \frac{X_t}{X_0})}{t} = b$$

Les deux taux de croissance obtenus ne sont de ce fait pas du tout comparable.

Osinga et son équipe [-@Osinga2011] émettent l'hypothèse suivante que les espèces branchues vont avoir une développement de type exponentielle alors que les espèce encroutante vont avoir une croissance linéaire.

Partons d'un exemple fictif pour illustrer ces deux situations, avec un organisme de 1 grammes avec un taux de croissance linéaire et exponentiel similaire de 0.1.

```{r}
w_ini <- 1
coef <- 0.1
example <- tibble::tibble(
  temps = c(0:8, 0:8), 
  mod = c(rep("lin", 9), rep("expo", 9)),
  masse = dplyr::case_when(mod == "lin" ~ w_ini + (coef*temps),
                           mod == "expo" ~ w_ini*exp(coef*temps)))

chart::chart(example, masse~temps %col=% mod) +
  ggplot2::geom_point() +
  ggplot2::geom_line() +
  ggplot2::labs( color = "Modèle")
```

# Croissance exponentielle 

## Cas théorique 

## Application

as concret

```{r}
library(coral.growth)
cg <- read("coral_growth", package = "coral.growth")
```


```{r}
growth_rate <- function(skw_t, skw_ini, date_t, date_ini = 0, 
                    method = "exponential") {
  
  # implemented method
  met <- c("exponential", "linear", "linear_std")
  # check method
  if(!any(met %in% method))
    stop("the method is not implemented. see the help page")
  
  # method
  if (method == "exponential") { 
    g_expo <- (log(skw_t/skw_ini)/(date_t - date_ini))*100
  } else if (method == "linear") { 
    g_lin <- (skw_t/skw_ini)/(date_t - date_ini)
  } else if (method == "linear_std") {
    g_lin_std <- (((skw_t/skw_ini)/skw_ini)/(date_t - date_ini))*100
  }
}
```


```{r}
cg$skw <- skeleton_weight(buoyant_weight = cg$weight, S = cg$salinity, T = cg$temperature)

cg %>.%
  filter(., id == "1") -> cg

cg %>.%
  mutate(.,
         skw_lag = lag(skw),
         dd_lag = lag(date),
         gr = growth_rate(skw_t = skw, skw_ini = skw_lag, 
                          date_t = date, date_ini = dd_lag, 
                          method = "exponential"),
         gr1 = log(skw / skw_lag)/(date - dd_lag),
         gr2 = growth_rate(skw_t = skw, skw_ini = skw_lag, 
                       date_t = date, date_ini = dd_lag),
         gg = gr/gr1) -> cg
```


# bibliographie
